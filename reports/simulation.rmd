---
output: html_document
author:
- name: Sangeeta Bhatia
  affiliation: Imperial College London
date: "`r format(Sys.time(), '%d %B, %Y')`"
geometry: margin=1in
fontfamily: mathpazo
fontsize: 11pt
spacing: double
bibliography: 
biblio-style: apsr
---

```{r setup, eval = TRUE}

library(dplyr)
library(magrittr)
library(ggplot2)
library(PopGenReport)
library(secr)
```
## Read in parameter values

```{r}
params <- here::here("R", "params.R")
source("params.R")

```

## Landscape Simulation

```{r ls_params}

mask <- secr::make.mask(nx = nx,
                        ny = ny,
                        spacing = 1)
habitat <- secr::randomHabitat(mask, p = p, A = A)
rstr    <- secr::raster(habitat)

values(rstr)[is.na(values(rstr)) == T] <- res
landscape <- rstr

```


## Population Initialization

```{r}
pops <- create_pops(n.pops, 
                    2,
                    landscape)

```


# initialize the populations ----
pop_new <- init_pops(n_pops    =  para$n_pops,
                     n_ind     =  para$n_ind,
                     sex_ratio =  para$sex_ratio,
                     n_allels  =  para$n_allels,
                     n_loci    =  para$n_loci,
                     n_cov     =  para$n_cov,
                     pops      =  pops)


# plan(batchtools_lsf)
plan(multisession)  
y <- future_lapply(para$resistance,
                   FUN =  simulate_abc,
                   rep_resistance = para$rep_resistance)
