---
output: html_document
author:
- name: Sangeeta Bhatia
  affiliation: Imperial College London
date: "`r format(Sys.time(), '%d %B, %Y')`"
geometry: margin=1in
fontfamily: mathpazo
fontsize: 11pt
spacing: double
bibliography: 
biblio-style: apsr
---

```{r setup, eval = TRUE}

library(dplyr)
library(magrittr)
library(ggplot2)
library(PopGenReport)
library(secr)
```
## Read in parameter values

```{r}
params <- here::here("R", "params.R")
source("params.R")

```

## Landscape Simulation

```{r ls_params}

mask <- secr::make.mask(nx = nx,
                        ny = ny,
                        spacing = 1)
habitat <- secr::randomHabitat(mask, p = p, A = A)
rstr    <- secr::raster(habitat)

values(rstr)[is.na(values(rstr)) == T] <- res
landscape <- rstr

```


## Population Initialization

```{r}
pops <- create_pops(n.pops, 
                    2,
                    landscape)

pop_new <- init_pops(n_pops    =  n_pops,
                     n_ind     =  n_ind,
                     sex_ratio =  sex_ratio,
                     n_allels  =  n_allels,
                     n_loci    =  n_loci,
                     n_cov     =  3,
                     pops      =  pops)

```

## Simulation

For each value of resistance, update the landscape, simulate
population and calculate summary statistics. Do this multiple times. 




# plan(batchtools_lsf)
plan(multisession)  
y <- future_lapply(resistance,
                   FUN =  simulate_abc,
                   rep_resistance = rep_resistance)
